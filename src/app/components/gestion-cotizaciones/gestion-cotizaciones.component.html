<div class="gestion-cotizaciones">
  <!-- Header -->
  <div class="header-gestion">
    <h2>ğŸ“‹ GestiÃ³n de Cotizaciones</h2>
    <p class="subtitle">Administra y da seguimiento a todas las cotizaciones</p>
  </div>

  <!-- EstadÃ­sticas rÃ¡pidas -->
  <div class="stats-grid">
    <div class="stat-card total">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-content">
        <span class="stat-value">{{ totalCotizaciones }}</span>
        <span class="stat-label">Total</span>
      </div>
    </div>

    <div class="stat-card pendiente">
      <div class="stat-icon">â³</div>
      <div class="stat-content">
        <span class="stat-value">{{ pendientes }}</span>
        <span class="stat-label">Pendientes</span>
      </div>
    </div>

    <div class="stat-card proceso">
      <div class="stat-icon">ğŸ”„</div>
      <div class="stat-content">
        <span class="stat-value">{{ enProceso }}</span>
        <span class="stat-label">En Proceso</span>
      </div>
    </div>

    <div class="stat-card completada">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <span class="stat-value">{{ completadas }}</span>
        <span class="stat-label">Completadas</span>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filtros-container">
    <div class="filtro-busqueda">
      <input 
        type="text" 
        [(ngModel)]="filtroBusqueda"
        (input)="aplicarFiltros()"
        placeholder="ğŸ” Buscar por nombre, email, nÃºmero..."
        class="input-busqueda">
    </div>

    <div class="filtro-estado">
      <select [(ngModel)]="filtroEstado" (change)="aplicarFiltros()" class="select-estado">
        <option value="todos">Todos los estados</option>
        <option value="pendiente">â³ Pendiente</option>
        <option value="en proceso">ğŸ”„ En Proceso</option>
        <option value="completada">âœ… Completada</option>
        <option value="cancelada">âŒ Cancelada</option>
      </select>
    </div>

    <button class="btn-limpiar" (click)="limpiarFiltros()">
      ğŸ§¹ Limpiar
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando cotizaciones...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="error-container">
    <span class="error-icon">âš ï¸</span>
    <p>{{ error }}</p>
  </div>

  <!-- Tabla de cotizaciones -->
  <div *ngIf="!loading && !error" class="tabla-container">
    <table class="tabla-gestion">
      <thead>
        <tr>
          <th>NÂ° CotizaciÃ³n</th>
          <th>Fecha</th>
          <th>Cliente</th>
          <th>Productos</th>
          <th>Estado</th>
          <th>Contacto</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let cot of cotizacionesFiltradas" class="fila-cotizacion">
          <!-- NÂ° CotizaciÃ³n -->
          <td class="col-numero">
            <span class="numero-cot">{{ cot.numeroCotizacion || 'N/A' }}</span>
          </td>

          <!-- Fecha -->
          <td class="col-fecha">
            <div class="fecha-info">
              <span class="fecha">{{ cot.fecha | date:'dd/MM/yyyy' }}</span>
              <span class="hora">{{ cot.fecha | date:'HH:mm' }}</span>
            </div>
          </td>

          <!-- Cliente -->
          <td class="col-cliente">
            <div class="cliente-info">
              <strong class="nombre">{{ cot.nombre }}</strong>
              <span class="email">{{ cot.email }}</span>
              <span class="telefono">ğŸ“± {{ cot.telefonoMovil }}</span>
              <span class="dni">ğŸ†” {{ cot.dniRuc || 'N/A' }}</span>
            </div>
          </td>

          <!-- Productos -->
          <td class="col-productos">
            <div class="productos-lista">
              <div *ngFor="let p of cot.productos" class="producto-item">
                <span class="producto-nombre">{{ getNombreProducto(p) }}</span>
                <span class="producto-cantidad">x{{ p.cantidad }}</span>
              </div>
              <span *ngIf="cot.productos.length === 0" class="sin-productos">Sin productos</span>
            </div>
          </td>

          <!-- Estado -->
          <td class="col-estado">
            <div class="estado-container">
              <select 
                [(ngModel)]="cot.estado" 
                (change)="actualizarEstado(cot._id, cot.estado)"
                [style.background]="getEstadoColor(cot.estado) + '20'"
                [style.color]="getEstadoColor(cot.estado)"
                class="select-estado-tabla">
                <option value="pendiente">â³ Pendiente</option>
                <option value="en proceso">ğŸ”„ En Proceso</option>
                <option value="completada">âœ… Completada</option>
                <option value="cancelada">âŒ Cancelada</option>
              </select>
            </div>
          </td>

          <!-- Contacto -->
          <td class="col-contacto">
            <div class="contacto-btns">
              <button 
*ngIf="cot.contacto && cot.contacto.toString().toLowerCase().includes('whatsapp')"
                (click)="abrirWhatsApp(cot)" 
                class="btn-contacto whatsapp"
                title="Enviar WhatsApp">
                ğŸ’¬
              </button>

              <button 
*ngIf="cot.contacto && cot.contacto.toString().toLowerCase().includes('correo')"
                (click)="abrirCorreo(cot)" 
                class="btn-contacto correo"
                title="Enviar correo">
                âœ‰ï¸
              </button>

              <button 
*ngIf="cot.contacto && cot.contacto.toString().toLowerCase().includes('tel')"
                (click)="llamarTelefono(cot)" 
                class="btn-contacto telefono"
                title="Llamar">
                ğŸ“
              </button>

              <span *ngIf="!cot.contacto || cot.contacto === 'No especificado'" class="sin-contacto">
                Sin contacto
              </span>
            </div>
          </td>

          <!-- Acciones -->
          <td class="col-acciones">
            <button 
              (click)="eliminarCotizacion(cot._id)" 
              class="btn-eliminar"
              title="Eliminar cotizaciÃ³n">
              ğŸ—‘ï¸
            </button>
          </td>
        </tr>

        <!-- Sin resultados -->
        <tr *ngIf="cotizacionesFiltradas.length === 0">
          <td colspan="7" class="sin-resultados">
            <div class="mensaje-vacio">
              <span class="icono-vacio">ğŸ”</span>
              <p>No se encontraron cotizaciones</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

